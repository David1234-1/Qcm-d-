<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Authentification StudyHub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    button {
      background: #007bff;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    .message {
      margin-top: 20px;
      padding: 10px;
      border-radius: 5px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      background: #e9ecef;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Test Authentification StudyHub</h1>
    
    <div class="status" id="status">
      <strong>Statut :</strong> <span id="status-text">Chargement...</span>
    </div>
    
    <h2>Inscription</h2>
    <form id="register-form">
      <div class="form-group">
        <label for="register-name">Nom complet</label>
        <input type="text" id="register-name" required>
      </div>
      <div class="form-group">
        <label for="register-email">Email</label>
        <input type="email" id="register-email" required>
      </div>
      <div class="form-group">
        <label for="register-password">Mot de passe</label>
        <input type="password" id="register-password" required>
      </div>
      <button type="submit">S'inscrire</button>
    </form>
    
    <h2>Connexion</h2>
    <form id="login-form">
      <div class="form-group">
        <label for="login-email">Email</label>
        <input type="email" id="login-email" required>
      </div>
      <div class="form-group">
        <label for="login-password">Mot de passe</label>
        <input type="password" id="login-password" required>
      </div>
      <button type="submit">Se connecter</button>
    </form>
    
    <div id="message"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
    
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCqGSBrsJ-7PIpfjAM58gD8h4VcY793rWQ",
      authDomain: "studyhub-proje.firebaseapp.com",
      projectId: "studyhub-proje",
      storageBucket: "studyhub-proje.appspot.com",
      messagingSenderId: "359347355393",
      appId: "1:359347355393:web:8c05ede417c10c272d6500",
      measurementId: "G-DMQJNJW9S0"
    };
    
    // Initialiser Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    
    // Éléments DOM
    const statusText = document.getElementById('status-text');
    const messageDiv = document.getElementById('message');
    const registerForm = document.getElementById('register-form');
    const loginForm = document.getElementById('login-form');
    
    // Fonction pour afficher les messages
    function showMessage(message, type = 'success') {
      messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
      setTimeout(() => {
        messageDiv.innerHTML = '';
      }, 5000);
    }
    
    // Écouter les changements d'état d'authentification
    auth.onAuthStateChanged((user) => {
      if (user) {
        statusText.textContent = `Connecté : ${user.email}`;
        statusText.style.color = 'green';
      } else {
        statusText.textContent = 'Non connecté';
        statusText.style.color = 'red';
      }
    });
    
    // Gestion de l'inscription
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      
      try {
        const { createUserWithEmailAndPassword, updateProfile } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js');
        
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        
        // Mettre à jour le profil avec le nom
        await updateProfile(userCredential.user, {
          displayName: name
        });
        
        showMessage('Inscription réussie !', 'success');
        registerForm.reset();
      } catch (error) {
        let errorMessage = 'Erreur d\'inscription';
        
        switch (error.code) {
          case 'auth/email-already-in-use':
            errorMessage = 'Un compte existe déjà avec cet email';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Adresse email invalide';
            break;
          case 'auth/weak-password':
            errorMessage = 'Le mot de passe est trop faible (minimum 6 caractères)';
            break;
          default:
            errorMessage = error.message;
        }
        
        showMessage(errorMessage, 'error');
      }
    });
    
    // Gestion de la connexion
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      try {
        const { signInWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js');
        
        await signInWithEmailAndPassword(auth, email, password);
        
        showMessage('Connexion réussie !', 'success');
        loginForm.reset();
      } catch (error) {
        let errorMessage = 'Erreur de connexion';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage = 'Aucun compte trouvé avec cet email';
            break;
          case 'auth/wrong-password':
            errorMessage = 'Mot de passe incorrect';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Adresse email invalide';
            break;
          default:
            errorMessage = error.message;
        }
        
        showMessage(errorMessage, 'error');
      }
    });
    
    // Initialisation
    statusText.textContent = 'Firebase initialisé';
  </script>
</body>
</html>